24/01/2026 06:52:53 >> Namespace(dataset='mimic_iii', model_type='sand', split_file='mimic_iii_5fold.json', fold=3, root_dir='/home/xiejun/codeLib/miccai', output_dir='../outputs/mimic_iii/sand|fold:3', lr=0.0005, train_batch_size=64, eval_batch_size=64, max_epochs=20, patience=5, validate_every=None, grad_clip_norm=1.0, max_obs=880, max_timesteps=880, device='cuda:3', seed=2026, hid_dim=128, num_layers=2, num_heads=4, dropout=0.2, r=10, M=16, logger=<utils.logger.Logger object at 0x797310106140>)

24/01/2026 06:52:53 >> Preparing dataset mimic_iii
24/01/2026 06:52:57 >> Using fold 3/5
24/01/2026 06:52:57 >> Loaded splits from mimic_iii_5fold.json
24/01/2026 06:53:25 >> # train, val, test TS: [33866, 8436, 10569]
24/01/2026 06:53:48 >> pos class weight: 7.0423
24/01/2026 06:53:48 >> % pos class in train, val, test splits: [0.1243, 0.1193, 0.1220]
24/01/2026 06:53:50 >> # static features: 3
24/01/2026 06:53:50 >> # TS variables (SAND): 127
24/01/2026 06:53:58 >> # timesteps (hours): 25
24/01/2026 06:54:21 >> Input shape: [N, 25, 381]

24/01/2026 06:54:21 >> Model details:
24/01/2026 06:54:21 >> # parameters: 353154
24/01/2026 06:54:21 >> # trainable parameters: 352129, 99.70975834904885%
24/01/2026 06:54:21 >> #params by dtype:
24/01/2026 06:54:21 >> torch.float32: 353154, 100.0%

24/01/2026 06:54:21 >> No. of training batches per epoch = 530

24/01/2026 06:54:21 >> ============================================================
24/01/2026 06:54:21 >>                Starting training...
24/01/2026 06:54:21 >> ============================================================
24/01/2026 06:54:21 >> >>> Epoch 1/20
24/01/2026 06:54:25 >> Epoch 1 completed | Avg Loss: 0.9677
24/01/2026 06:54:25 >> EVAL_TRAIN   Epoch:     1 | AUROC: 0.9091 | AUPRC: 0.5850 | MinRP: 0.5763
24/01/2026 06:54:26 >> VAL          Epoch:     1 | AUROC: 0.8828 | AUPRC: 0.5703 | MinRP: 0.5557
24/01/2026 06:54:26 >> AUPRC improved: 0.0000 ---> 0.5703 (+0.5703)
24/01/2026 06:54:26 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:54:26 >> ============================================================
24/01/2026 06:54:26 >> >>> Epoch 2/20
24/01/2026 06:54:30 >> Epoch 2 completed | Avg Loss: 0.8340
24/01/2026 06:54:30 >> EVAL_TRAIN   Epoch:     2 | AUROC: 0.9128 | AUPRC: 0.5985 | MinRP: 0.5880
24/01/2026 06:54:30 >> VAL          Epoch:     2 | AUROC: 0.8824 | AUPRC: 0.5699 | MinRP: 0.5526
24/01/2026 06:54:30 >> No improvement. Wait: 4/5
24/01/2026 06:54:30 >> ============================================================
24/01/2026 06:54:30 >> >>> Epoch 3/20
24/01/2026 06:54:33 >> Epoch 3 completed | Avg Loss: 0.8046
24/01/2026 06:54:33 >> EVAL_TRAIN   Epoch:     3 | AUROC: 0.9187 | AUPRC: 0.6022 | MinRP: 0.5957
24/01/2026 06:54:34 >> VAL          Epoch:     3 | AUROC: 0.8876 | AUPRC: 0.5704 | MinRP: 0.5596
24/01/2026 06:54:34 >> AUPRC improved: 0.5703 ---> 0.5704 (+0.0001)
24/01/2026 06:54:34 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:54:34 >> ============================================================
24/01/2026 06:54:34 >> >>> Epoch 4/20
24/01/2026 06:54:38 >> Epoch 4 completed | Avg Loss: 0.7869
24/01/2026 06:54:38 >> EVAL_TRAIN   Epoch:     4 | AUROC: 0.9213 | AUPRC: 0.6040 | MinRP: 0.5872
24/01/2026 06:54:38 >> VAL          Epoch:     4 | AUROC: 0.8887 | AUPRC: 0.5852 | MinRP: 0.5626
24/01/2026 06:54:38 >> AUPRC improved: 0.5704 ---> 0.5852 (+0.0148)
24/01/2026 06:54:38 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:54:38 >> ============================================================
24/01/2026 06:54:38 >> >>> Epoch 5/20
24/01/2026 06:54:41 >> Epoch 5 completed | Avg Loss: 0.7711
24/01/2026 06:54:41 >> EVAL_TRAIN   Epoch:     5 | AUROC: 0.9248 | AUPRC: 0.6229 | MinRP: 0.5792
24/01/2026 06:54:42 >> VAL          Epoch:     5 | AUROC: 0.8905 | AUPRC: 0.5894 | MinRP: 0.5716
24/01/2026 06:54:42 >> AUPRC improved: 0.5852 ---> 0.5894 (+0.0042)
24/01/2026 06:54:42 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:54:42 >> ============================================================
24/01/2026 06:54:42 >> >>> Epoch 6/20
24/01/2026 06:54:45 >> Epoch 6 completed | Avg Loss: 0.7539
24/01/2026 06:54:45 >> EVAL_TRAIN   Epoch:     6 | AUROC: 0.9271 | AUPRC: 0.6237 | MinRP: 0.5935
24/01/2026 06:54:45 >> VAL          Epoch:     6 | AUROC: 0.8913 | AUPRC: 0.5787 | MinRP: 0.5680
24/01/2026 06:54:45 >> No improvement. Wait: 4/5
24/01/2026 06:54:45 >> ============================================================
24/01/2026 06:54:45 >> >>> Epoch 7/20
24/01/2026 06:54:49 >> Epoch 7 completed | Avg Loss: 0.7616
24/01/2026 06:54:49 >> EVAL_TRAIN   Epoch:     7 | AUROC: 0.9270 | AUPRC: 0.6263 | MinRP: 0.5932
24/01/2026 06:54:49 >> VAL          Epoch:     7 | AUROC: 0.8900 | AUPRC: 0.5834 | MinRP: 0.5644
24/01/2026 06:54:49 >> No improvement. Wait: 3/5
24/01/2026 06:54:49 >> ============================================================
24/01/2026 06:54:49 >> >>> Epoch 8/20
24/01/2026 06:54:52 >> Epoch 8 completed | Avg Loss: 0.7380
24/01/2026 06:54:53 >> EVAL_TRAIN   Epoch:     8 | AUROC: 0.9277 | AUPRC: 0.6405 | MinRP: 0.5885
24/01/2026 06:54:53 >> VAL          Epoch:     8 | AUROC: 0.8896 | AUPRC: 0.6005 | MinRP: 0.5554
24/01/2026 06:54:53 >> AUPRC improved: 0.5894 ---> 0.6005 (+0.0111)
24/01/2026 06:54:53 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:54:53 >> ============================================================
24/01/2026 06:54:53 >> >>> Epoch 9/20
24/01/2026 06:54:56 >> Epoch 9 completed | Avg Loss: 0.7374
24/01/2026 06:54:56 >> EVAL_TRAIN   Epoch:     9 | AUROC: 0.9336 | AUPRC: 0.6717 | MinRP: 0.6167
24/01/2026 06:54:56 >> VAL          Epoch:     9 | AUROC: 0.8901 | AUPRC: 0.6044 | MinRP: 0.5531
24/01/2026 06:54:56 >> AUPRC improved: 0.6005 ---> 0.6044 (+0.0039)
24/01/2026 06:54:56 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:54:56 >> ============================================================
24/01/2026 06:54:56 >> >>> Epoch 10/20
24/01/2026 06:55:00 >> Epoch 10 completed | Avg Loss: 0.7154
24/01/2026 06:55:00 >> EVAL_TRAIN   Epoch:    10 | AUROC: 0.9329 | AUPRC: 0.6577 | MinRP: 0.6107
24/01/2026 06:55:00 >> VAL          Epoch:    10 | AUROC: 0.8944 | AUPRC: 0.6080 | MinRP: 0.5815
24/01/2026 06:55:00 >> AUPRC improved: 0.6044 ---> 0.6080 (+0.0036)
24/01/2026 06:55:00 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:55:00 >> ============================================================
24/01/2026 06:55:00 >> >>> Epoch 11/20
24/01/2026 06:55:03 >> Epoch 11 completed | Avg Loss: 0.7012
24/01/2026 06:55:04 >> EVAL_TRAIN   Epoch:    11 | AUROC: 0.9293 | AUPRC: 0.6475 | MinRP: 0.6017
24/01/2026 06:55:04 >> VAL          Epoch:    11 | AUROC: 0.8923 | AUPRC: 0.5939 | MinRP: 0.5616
24/01/2026 06:55:04 >> No improvement. Wait: 4/5
24/01/2026 06:55:04 >> ============================================================
24/01/2026 06:55:04 >> >>> Epoch 12/20
24/01/2026 06:55:08 >> Epoch 12 completed | Avg Loss: 0.6983
24/01/2026 06:55:08 >> EVAL_TRAIN   Epoch:    12 | AUROC: 0.9359 | AUPRC: 0.6856 | MinRP: 0.6311
24/01/2026 06:55:08 >> VAL          Epoch:    12 | AUROC: 0.8939 | AUPRC: 0.6149 | MinRP: 0.5697
24/01/2026 06:55:08 >> AUPRC improved: 0.6080 ---> 0.6149 (+0.0070)
24/01/2026 06:55:08 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:55:08 >> ============================================================
24/01/2026 06:55:08 >> >>> Epoch 13/20
24/01/2026 06:55:12 >> Epoch 13 completed | Avg Loss: 0.6903
24/01/2026 06:55:12 >> EVAL_TRAIN   Epoch:    13 | AUROC: 0.9383 | AUPRC: 0.7000 | MinRP: 0.6398
24/01/2026 06:55:12 >> VAL          Epoch:    13 | AUROC: 0.8957 | AUPRC: 0.6243 | MinRP: 0.5800
24/01/2026 06:55:12 >> AUPRC improved: 0.6149 ---> 0.6243 (+0.0094)
24/01/2026 06:55:12 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:55:12 >> ============================================================
24/01/2026 06:55:12 >> >>> Epoch 14/20
24/01/2026 06:55:16 >> Epoch 14 completed | Avg Loss: 0.6760
24/01/2026 06:55:16 >> EVAL_TRAIN   Epoch:    14 | AUROC: 0.9404 | AUPRC: 0.7094 | MinRP: 0.6488
24/01/2026 06:55:16 >> VAL          Epoch:    14 | AUROC: 0.8919 | AUPRC: 0.6177 | MinRP: 0.5547
24/01/2026 06:55:16 >> No improvement. Wait: 4/5
24/01/2026 06:55:16 >> ============================================================
24/01/2026 06:55:16 >> >>> Epoch 15/20
24/01/2026 06:55:20 >> Epoch 15 completed | Avg Loss: 0.6658
24/01/2026 06:55:21 >> EVAL_TRAIN   Epoch:    15 | AUROC: 0.9436 | AUPRC: 0.7127 | MinRP: 0.6340
24/01/2026 06:55:21 >> VAL          Epoch:    15 | AUROC: 0.8939 | AUPRC: 0.6162 | MinRP: 0.5726
24/01/2026 06:55:21 >> No improvement. Wait: 3/5
24/01/2026 06:55:21 >> ============================================================
24/01/2026 06:55:21 >> >>> Epoch 16/20
24/01/2026 06:55:24 >> Epoch 16 completed | Avg Loss: 0.6622
24/01/2026 06:55:25 >> EVAL_TRAIN   Epoch:    16 | AUROC: 0.9453 | AUPRC: 0.7247 | MinRP: 0.6553
24/01/2026 06:55:25 >> VAL          Epoch:    16 | AUROC: 0.8942 | AUPRC: 0.6225 | MinRP: 0.5799
24/01/2026 06:55:25 >> No improvement. Wait: 2/5
24/01/2026 06:55:25 >> ============================================================
24/01/2026 06:55:25 >> >>> Epoch 17/20
24/01/2026 06:55:28 >> Epoch 17 completed | Avg Loss: 0.6540
24/01/2026 06:55:28 >> EVAL_TRAIN   Epoch:    17 | AUROC: 0.9465 | AUPRC: 0.7308 | MinRP: 0.6681
24/01/2026 06:55:29 >> VAL          Epoch:    17 | AUROC: 0.8866 | AUPRC: 0.6116 | MinRP: 0.5636
24/01/2026 06:55:29 >> No improvement. Wait: 1/5
24/01/2026 06:55:29 >> ============================================================
24/01/2026 06:55:29 >> >>> Epoch 18/20
24/01/2026 06:55:32 >> Epoch 18 completed | Avg Loss: 0.6502
24/01/2026 06:55:32 >> EVAL_TRAIN   Epoch:    18 | AUROC: 0.9503 | AUPRC: 0.7309 | MinRP: 0.6596
24/01/2026 06:55:32 >> VAL          Epoch:    18 | AUROC: 0.8942 | AUPRC: 0.6243 | MinRP: 0.5875
24/01/2026 06:55:32 >> AUPRC improved: 0.6243 ---> 0.6243 (+0.0000)
24/01/2026 06:55:32 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:55:32 >> ============================================================
24/01/2026 06:55:32 >> >>> Epoch 19/20
24/01/2026 06:55:35 >> Epoch 19 completed | Avg Loss: 0.6313
24/01/2026 06:55:35 >> EVAL_TRAIN   Epoch:    19 | AUROC: 0.9496 | AUPRC: 0.7409 | MinRP: 0.6638
24/01/2026 06:55:36 >> VAL          Epoch:    19 | AUROC: 0.8937 | AUPRC: 0.6295 | MinRP: 0.5765
24/01/2026 06:55:36 >> AUPRC improved: 0.6243 ---> 0.6295 (+0.0052)
24/01/2026 06:55:36 >> Saving checkpoint to ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:55:36 >> ============================================================
24/01/2026 06:55:36 >> >>> Epoch 20/20
24/01/2026 06:55:39 >> Epoch 20 completed | Avg Loss: 0.6271
24/01/2026 06:55:39 >> EVAL_TRAIN   Epoch:    20 | AUROC: 0.9552 | AUPRC: 0.7556 | MinRP: 0.6878
24/01/2026 06:55:39 >> VAL          Epoch:    20 | AUROC: 0.8929 | AUPRC: 0.6215 | MinRP: 0.5706
24/01/2026 06:55:39 >> No improvement. Wait: 4/5
24/01/2026 06:55:39 >> ============================================================

24/01/2026 06:55:39 >> ============================================================
24/01/2026 06:55:39 >> TRAINING COMPLETED
24/01/2026 06:55:39 >> ============================================================
24/01/2026 06:55:39 >> Best Validation Results:
24/01/2026 06:55:39 >>   AUROC: 0.8937 | AUPRC: 0.6295 | MinRP: 0.5765
24/01/2026 06:55:39 >> Loading best model from ../outputs/mimic_iii/sand|fold:3/checkpoint_best.bin
24/01/2026 06:55:39 >> Evaluating on test set...
24/01/2026 06:55:40 >> TEST         AUROC: 0.8960 | AUPRC: 0.6378 | MinRP: 0.5865 | Accuracy: 0.8831

24/01/2026 06:55:40 >> ============================================================
24/01/2026 06:55:40 >> Classification Report:
24/01/2026 06:55:40 >>               precision    recall  f1-score   support
24/01/2026 06:55:40 >> 
24/01/2026 06:55:40 >>          0.0     0.9531    0.9116    0.9319      9280
24/01/2026 06:55:40 >>          1.0     0.5157    0.6773    0.5855      1289
24/01/2026 06:55:40 >> 
24/01/2026 06:55:40 >>     accuracy                         0.8831     10569
24/01/2026 06:55:40 >>    macro avg     0.7344    0.7945    0.7587     10569
24/01/2026 06:55:40 >> weighted avg     0.8998    0.8831    0.8897     10569
24/01/2026 06:55:40 >> 
24/01/2026 06:55:40 >> Confusion Matrix:
24/01/2026 06:55:40 >> [8460, 820]
24/01/2026 06:55:40 >> [416, 873]
24/01/2026 06:55:40 >> ============================================================
24/01/2026 06:55:40 >> Final Test Results:
24/01/2026 06:55:40 >>   AUROC: 0.8960 | AUPRC: 0.6378 | MinRP: 0.5865 | Accuracy: 0.8831
24/01/2026 06:55:40 >> ============================================================
